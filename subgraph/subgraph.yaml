# ═══════════════════════════════════════════════════════════════
# Minted Protocol — Subgraph Manifest
# ═══════════════════════════════════════════════════════════════
# Deploy:
#   graph codegen && graph build
#   graph deploy --node https://api.thegraph.com/deploy/ minted/musd-protocol
# ═══════════════════════════════════════════════════════════════

specVersion: 0.0.5
schema:
  file: ./schema.graphql

dataSources:
  # ─── DirectMintV2 (Mint/Redeem) ───────────────────────────
  - kind: ethereum
    name: DirectMintV2
    network: sepolia  # Change to mainnet for production
    source:
      address: "0x0000000000000000000000000000000000000000"  # TODO: deployed address
      abi: DirectMintV2
      startBlock: 0  # TODO: deployment block
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Activity
        - User
        - ProtocolStats
        - DailySnapshot
        - HourlySnapshot
      abis:
        - name: DirectMintV2
          file: ./abis/DirectMintV2.json
      eventHandlers:
        - event: Minted(indexed address,uint256,uint256,uint256)
          handler: handleMinted
        - event: Redeemed(indexed address,uint256,uint256,uint256)
          handler: handleRedeemed
      file: ./src/direct-mint.ts

  # ─── SMUSD (Stake/Unstake) ────────────────────────────────
  - kind: ethereum
    name: SMUSD
    network: sepolia
    source:
      address: "0x0000000000000000000000000000000000000000"  # TODO
      abi: SMUSD
      startBlock: 0
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Activity
        - User
        - ProtocolStats
        - DailySnapshot
      abis:
        - name: SMUSD
          file: ./abis/SMUSD.json
      eventHandlers:
        - event: Deposit(indexed address,indexed address,uint256,uint256)
          handler: handleStake
        - event: Withdraw(indexed address,indexed address,indexed address,uint256,uint256)
          handler: handleUnstake
        - event: YieldDistributed(uint256,uint256)
          handler: handleYieldDistributed
      file: ./src/smusd.ts

  # ─── BorrowModule ─────────────────────────────────────────
  - kind: ethereum
    name: BorrowModule
    network: sepolia
    source:
      address: "0x0000000000000000000000000000000000000000"  # TODO
      abi: BorrowModule
      startBlock: 0
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Activity
        - User
        - BorrowPosition
        - ProtocolStats
        - DailySnapshot
      abis:
        - name: BorrowModule
          file: ./abis/BorrowModule.json
      eventHandlers:
        - event: Borrowed(indexed address,uint256)
          handler: handleBorrowed
        - event: Repaid(indexed address,uint256)
          handler: handleRepaid
      file: ./src/borrow-module.ts

  # ─── CollateralVault ──────────────────────────────────────
  - kind: ethereum
    name: CollateralVault
    network: sepolia
    source:
      address: "0x0000000000000000000000000000000000000000"  # TODO
      abi: CollateralVault
      startBlock: 0
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Activity
        - User
        - CollateralPosition
        - ProtocolStats
      abis:
        - name: CollateralVault
          file: ./abis/CollateralVault.json
      eventHandlers:
        - event: Deposited(indexed address,indexed address,uint256)
          handler: handleCollateralDeposited
        - event: Withdrawn(indexed address,indexed address,uint256)
          handler: handleCollateralWithdrawn
      file: ./src/collateral-vault.ts

  # ─── LiquidationEngine ────────────────────────────────────
  - kind: ethereum
    name: LiquidationEngine
    network: sepolia
    source:
      address: "0x0000000000000000000000000000000000000000"  # TODO
      abi: LiquidationEngine
      startBlock: 0
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Activity
        - User
        - ProtocolStats
        - DailySnapshot
      abis:
        - name: LiquidationEngine
          file: ./abis/LiquidationEngine.json
      eventHandlers:
        - event: Liquidated(indexed address,indexed address,indexed address,uint256,uint256)
          handler: handleLiquidated
      file: ./src/liquidation-engine.ts

  # ─── BLEBridgeV9 ──────────────────────────────────────────
  - kind: ethereum
    name: BLEBridgeV9
    network: sepolia
    source:
      address: "0x0000000000000000000000000000000000000000"  # TODO
      abi: BLEBridgeV9
      startBlock: 0
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Activity
        - User
        - BridgeTransfer
        - ProtocolStats
        - DailySnapshot
      abis:
        - name: BLEBridgeV9
          file: ./abis/BLEBridgeV9.json
      eventHandlers:
        - event: Attested(indexed uint256,indexed address,uint256,bytes32)
          handler: handleBridgeIn
        - event: BridgedOut(indexed address,uint256,uint16)
          handler: handleBridgeOut
      file: ./src/ble-bridge.ts

  # ─── LeverageVault ────────────────────────────────────────
  - kind: ethereum
    name: LeverageVault
    network: sepolia
    source:
      address: "0x0000000000000000000000000000000000000000"  # TODO
      abi: LeverageVault
      startBlock: 0
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Activity
        - User
        - ProtocolStats
      abis:
        - name: LeverageVault
          file: ./abis/LeverageVault.json
      eventHandlers:
        - event: PositionOpened(indexed address,indexed address,uint256,uint256,uint256)
          handler: handleLeverageOpened
        - event: PositionClosed(indexed address,uint256,uint256)
          handler: handleLeverageClosed
      file: ./src/leverage-vault.ts

  # ─── MUSD (Supply tracking) ───────────────────────────────
  - kind: ethereum
    name: MUSD
    network: sepolia
    source:
      address: "0x0000000000000000000000000000000000000000"  # TODO
      abi: MUSD
      startBlock: 0
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - ProtocolStats
        - DailySnapshot
        - HourlySnapshot
      abis:
        - name: MUSD
          file: ./abis/MUSD.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleMUSDTransfer
      file: ./src/musd.ts
