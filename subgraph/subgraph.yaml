# ── Minted mUSD Protocol Subgraph Manifest ─────────────────────────
# Provides on-chain observability for critical protocol events.
# Deployed: Sepolia testnet (chainId 11155111), block 10276940+
# Deployer: 0xe640db3Ad56330BFF39Da36Ef01ab3aEB699F8e0 (2026-02-17)
# For mainnet: update addresses, startBlock, and network field.

specVersion: 1.0.0
indexerHints:
  prune: auto
schema:
  file: ./schema.graphql

dataSources:
  # ── mUSD Token ─────────────────────────────────────────────────
  - kind: ethereum
    name: MUSD
    network: sepolia
    source:
      address: "0xEAf4EFECA6d312b02A168A8ffde696bc61bf870B"
      abi: MUSD
      startBlock: 10276940
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - MintEvent
        - BurnEvent
        - SupplyCapChange
        - BlacklistEvent
      abis:
        - name: MUSD
          file: ../artifacts/contracts/MUSD.sol/MUSD.json
      eventHandlers:
        - event: Mint(indexed address,uint256)
          handler: handleMint
        - event: Burn(indexed address,uint256)
          handler: handleBurn
        - event: SupplyCapUpdated(uint256,uint256)
          handler: handleSupplyCapUpdated
        - event: BlacklistUpdated(indexed address,bool)
          handler: handleBlacklistUpdated
      file: ./src/musd.ts

  # ── sMUSD Vault ────────────────────────────────────────────────
  - kind: ethereum
    name: SMUSD
    network: sepolia
    source:
      address: "0x8036D2bB19b20C1dE7F9b0742E2B0bB3D8b8c540"
      abi: SMUSD
      startBlock: 10276940
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - StakeEvent
        - UnstakeEvent
        - InterestReceived
        - CantonShareSync
      abis:
        - name: SMUSD
          file: ../artifacts/contracts/SMUSD.sol/SMUSD.json
      eventHandlers:
        - event: YieldDistributed(indexed address,uint256)
          handler: handleYieldDistributed
        - event: CantonSharesSynced(uint256,uint256,uint256)
          handler: handleCantonSharesSynced
        - event: InterestReceived(indexed address,uint256,uint256)
          handler: handleInterestReceived
      file: ./src/smusd.ts

  # ── BLE Bridge ─────────────────────────────────────────────────
  - kind: ethereum
    name: BLEBridgeV9
    network: sepolia
    source:
      address: "0x708957bFfA312D1730BdF87467E695D3a9F26b0f"
      abi: BLEBridgeV9
      startBlock: 10276940
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Attestation
        - EmergencyCapReduction
        - ProtocolStats
      abis:
        - name: BLEBridgeV9
          file: ../artifacts/contracts/BLEBridgeV9.sol/BLEBridgeV9.json
      eventHandlers:
        - event: AttestationReceived(indexed bytes32,uint256,uint256,uint256,uint256)
          handler: handleAttestationReceived
        - event: EmergencyCapReduction(uint256,uint256,string)
          handler: handleEmergencyCapReduction
        - event: SupplyCapUpdated(uint256,uint256,uint256)
          handler: handleBridgeSupplyCapUpdated
        - event: AttestationInvalidated(indexed bytes32,string)
          handler: handleAttestationInvalidated
      file: ./src/ble-bridge.ts

  # ── Borrow Module ──────────────────────────────────────────────
  - kind: ethereum
    name: BorrowModule
    network: sepolia
    source:
      address: "0xC5A1c2F5CF40dCFc33e7FCda1e6042EF4456Eae8"
      abi: BorrowModule
      startBlock: 10276940
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - BorrowEvent
        - RepayEvent
        - ProtocolStats
      abis:
        - name: BorrowModule
          file: ../artifacts/contracts/BorrowModule.sol/BorrowModule.json
      eventHandlers:
        - event: Borrowed(indexed address,uint256,uint256)
          handler: handleBorrowed
        - event: Repaid(indexed address,uint256,uint256)
          handler: handleRepaid
        - event: GlobalInterestAccrued(uint256,uint256,uint256)
          handler: handleGlobalInterestAccrued
      file: ./src/borrow-module.ts

  # ── Collateral Vault ───────────────────────────────────────────
  - kind: ethereum
    name: CollateralVault
    network: sepolia
    source:
      address: "0x155d6618dcdeb2F4145395CA57C80e6931D7941e"
      abi: CollateralVault
      startBlock: 10276940
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - CollateralDeposit
        - CollateralWithdrawal
      abis:
        - name: CollateralVault
          file: ../artifacts/contracts/CollateralVault.sol/CollateralVault.json
      eventHandlers:
        - event: Deposited(indexed address,indexed address,uint256)
          handler: handleDeposited
        - event: Withdrawn(indexed address,indexed address,uint256)
          handler: handleWithdrawn
        - event: Seized(indexed address,indexed address,uint256,indexed address)
          handler: handleSeized
      file: ./src/collateral-vault.ts

  # ── Direct Mint ────────────────────────────────────────────────
  - kind: ethereum
    name: DirectMintV2
    network: sepolia
    source:
      address: "0xaA3e42f2AfB5DF83d6a33746c2927bce8B22Bae7"
      abi: DirectMintV2
      startBlock: 10276940
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - DirectMint
        - DirectRedeem
      abis:
        - name: DirectMintV2
          file: ../artifacts/contracts/DirectMintV2.sol/DirectMintV2.json
      eventHandlers:
        - event: Minted(indexed address,uint256,uint256,uint256)
          handler: handleMinted
        - event: Redeemed(indexed address,uint256,uint256,uint256)
          handler: handleRedeemed
      file: ./src/direct-mint.ts

  # ── Liquidation Engine ─────────────────────────────────────────
  - kind: ethereum
    name: LiquidationEngine
    network: sepolia
    source:
      address: "0xbaf131Ee1AfdA4207f669DCd9F94634131D111f8"
      abi: LiquidationEngine
      startBlock: 10276940
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - LiquidationEvent
        - BadDebtEvent
        - ProtocolStats
      abis:
        - name: LiquidationEngine
          file: ../artifacts/contracts/LiquidationEngine.sol/LiquidationEngine.json
      eventHandlers:
        - event: Liquidation(indexed address,indexed address,indexed address,uint256,uint256)
          handler: handleLiquidation
        - event: BadDebtRecorded(indexed address,uint256,uint256)
          handler: handleBadDebtRecorded
        - event: BadDebtSocialized(indexed address,uint256,uint256)
          handler: handleBadDebtSocialized
      file: ./src/liquidation-engine.ts

  # ── Leverage Vault ─────────────────────────────────────────────
  - kind: ethereum
    name: LeverageVault
    network: sepolia
    source:
      address: "0x3b49d47f9714836F2aF21F13cdF79aafd75f1FE4"
      abi: LeverageVault
      startBlock: 10276940
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - LeverageOpen
        - LeverageClose
      abis:
        - name: LeverageVault
          file: ../artifacts/contracts/LeverageVault.sol/LeverageVault.json
      eventHandlers:
        - event: LeverageOpened(indexed address,indexed address,uint256,uint256,uint256,uint256,uint256)
          handler: handleLeverageOpened
        - event: LeverageClosed(indexed address,indexed address,uint256,uint256,uint256)
          handler: handleLeverageClosed
      file: ./src/leverage-vault.ts

  # ── Timelock Governance ────────────────────────────────────────
  - kind: ethereum
    name: MintedTimelockController
    network: sepolia
    source:
      address: "0xcF1473dFdBFf5BDAd66730a01316d4A74B2dA410"
      abi: MintedTimelockController
      startBlock: 10276940
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - TimelockOperation
        - TimelockDelayChange
        - RoleChange
      abis:
        - name: MintedTimelockController
          file: ../artifacts/contracts/MintedTimelockController.sol/MintedTimelockController.json
      eventHandlers:
        - event: CallScheduled(indexed bytes32,indexed uint256,address,uint256,bytes,bytes32,uint256)
          handler: handleCallScheduled
        - event: CallExecuted(indexed bytes32,indexed uint256,address,uint256,bytes)
          handler: handleCallExecuted
        - event: Cancelled(indexed bytes32)
          handler: handleCancelled
        - event: MinDelayChange(uint256,uint256)
          handler: handleMinDelayChange
        - event: RoleGranted(indexed bytes32,indexed address,indexed address)
          handler: handleRoleGranted
        - event: RoleRevoked(indexed bytes32,indexed address,indexed address)
          handler: handleRoleRevoked
      file: ./src/timelock.ts

  # ── Global Pause Registry ──────────────────────────────────────
  - kind: ethereum
    name: GlobalPauseRegistry
    network: sepolia
    source:
      address: "0x471e9dceB2AB7398b63677C70c6C638c7AEA375F"
      abi: GlobalPauseRegistry
      startBlock: 10276940
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - GlobalPauseEvent
      abis:
        - name: GlobalPauseRegistry
          file: ../artifacts/contracts/GlobalPauseRegistry.sol/GlobalPauseRegistry.json
      eventHandlers:
        - event: GlobalPauseStateChanged(bool,indexed address)
          handler: handleGlobalPauseStateChanged
      file: ./src/global-pause.ts

  # ── Price Oracle ───────────────────────────────────────────────
  - kind: ethereum
    name: PriceOracle
    network: sepolia
    source:
      address: "0x8eF615b3b87dfad172030087Ad0cFA5bAdCEa025"
      abi: PriceOracle
      startBlock: 10276940
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - FeedUpdate
        - CircuitBreakerEvent
        - CircuitBreakerRecovery
      abis:
        - name: PriceOracle
          file: ../artifacts/contracts/PriceOracle.sol/PriceOracle.json
      eventHandlers:
        - event: FeedUpdated(indexed address,address,uint256,uint8)
          handler: handleFeedUpdated
        - event: FeedRemoved(indexed address)
          handler: handleFeedRemoved
        - event: CircuitBreakerTriggered(indexed address,uint256,uint256,uint256)
          handler: handleCircuitBreakerTriggered
        - event: CircuitBreakerAutoRecovered(indexed address,uint256)
          handler: handleCircuitBreakerAutoRecovered
        - event: KeeperRecovery(indexed address,indexed address,uint256)
          handler: handleKeeperRecovery
      file: ./src/price-oracle.ts

  # ── Treasury V2 ────────────────────────────────────────────────
  - kind: ethereum
    name: TreasuryV2
    network: sepolia
    source:
      address: "0xf2051bDfc738f638668DF2f8c00d01ba6338C513"
      abi: TreasuryV2
      startBlock: 10276940
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - TreasuryDeposit
        - TreasuryWithdrawal
        - StrategyChange
        - TreasuryRebalance
      abis:
        - name: TreasuryV2
          file: ../artifacts/contracts/TreasuryV2.sol/TreasuryV2.json
      eventHandlers:
        - event: Deposited(indexed address,uint256,uint256[])
          handler: handleTreasuryDeposited
        - event: Withdrawn(indexed address,uint256)
          handler: handleTreasuryWithdrawn
        - event: StrategyAdded(indexed address,uint256)
          handler: handleStrategyAdded
        - event: StrategyRemoved(indexed address)
          handler: handleStrategyRemoved
        - event: StrategyUpdated(indexed address,uint256)
          handler: handleStrategyUpdated
        - event: Rebalanced(uint256)
          handler: handleRebalanced
        - event: EmergencyWithdraw(uint256)
          handler: handleEmergencyWithdraw
      file: ./src/treasury.ts
