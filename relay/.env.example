# Minted Bridge Relay — Environment Variable Reference
#
# Copy to .env (development) or configure via Docker secrets / K8s secrets (production)
# NEVER commit .env files containing real keys — use .gitignore
#
# ─── Canton Ledger API ────────────────────────────────────────
NODE_ENV=development

# Canton HTTP JSON API v2 endpoint
CANTON_HOST=localhost
CANTON_PORT=7575
CANTON_USE_TLS=false
# JWT bearer token (use Docker secret /run/secrets/canton_token in production)
CANTON_TOKEN=dummy-no-auth
# Aggregator party ID (from canton-init.sh output)
CANTON_PARTY=minted-validator-1::1220REPLACE_ME

# ─── Ethereum / Sepolia ──────────────────────────────────────
# RPC URL (use Docker secret /run/secrets/ethereum_rpc_url in production — contains API key)
ETHEREUM_RPC_URL=https://eth-sepolia.g.alchemy.com/v2/YOUR_API_KEY
# BLEBridgeV9 proxy address
BRIDGE_CONTRACT_ADDRESS=0xB466be5F516F7Aa45E61bA2C7d2Db639c7B3D125
# TreasuryV2 address (for auto-deploy trigger)
TREASURY_ADDRESS=0xf2051bDfc738f638668DF2f8c00d01ba6338C513
# Confirmations: 2 (Sepolia), 12 (Mainnet)
CONFIRMATIONS=2
POLL_INTERVAL_MS=5000

# ─── Relayer Signing ─────────────────────────────────────────
# Hot wallet private key — DEPRECATED: prefer KMS below
# (use Docker secret /run/secrets/relayer_private_key in production)
RELAYER_PRIVATE_KEY=0x_REPLACE_ME_NEVER_COMMIT
# AWS KMS key for relay transaction signing (key never leaves KMS)
# RELAYER_KMS_KEY_ID=arn:aws:kms:us-east-1:123456789:key/abcdef-1234
# AWS_REGION=us-east-1

# ─── Validator Address Mapping ────────────────────────────────
# JSON map: DAML Party ID → Ethereum address
# Required for signature verification (Party strings ≠ ETH addresses)
VALIDATOR_ADDRESSES={"minted-validator-1::1220REPLACE":"0xVALIDATOR_ETH_ADDRESS"}

# ─── Optional ────────────────────────────────────────────────
# Auto-deploy trigger (calls TreasuryV2.deploy after bridge-in)
TRIGGER_AUTO_DEPLOY=false
# Fallback RPC URLs (comma-separated, tried on primary failure)
# FALLBACK_RPC_URLS=https://rpc2.example.com,https://rpc3.example.com
# Health server bind
HEALTH_PORT=8080
HEALTH_BIND_HOST=127.0.0.1

# ─── H-1: Rate Limiting ──────────────────────────────────────
# Max attestation submissions per minute / hour / block
RATE_LIMIT_TX_PER_MINUTE=10
RATE_LIMIT_TX_PER_HOUR=60
RATE_LIMIT_TX_PER_BLOCK=1

# ─── H-2: Pause Guardian (Anomaly Detection) ─────────────────
# Auto-pause if Canton asset change exceeds this percentage
PAUSE_CAP_CHANGE_PCT=20
# Auto-pause after N consecutive transaction reverts
PAUSE_MAX_REVERTS=5

# ─── M-4: Graceful Shutdown ──────────────────────────────────
# Max time (ms) to wait for in-flight operations on SIGTERM
SHUTDOWN_DRAIN_TIMEOUT_MS=30000
