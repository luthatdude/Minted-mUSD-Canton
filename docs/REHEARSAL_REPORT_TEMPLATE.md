# V9 Migration Dress Rehearsal Report — Template

> **Generated by:** `scripts/rehearsal-v9-migration.sh`
> **Date:** _YYYY-MM-DD HH:MM UTC_
> **Network:** _sepolia / mainnet-fork_
> **Operator:** _name@host_

---

## Pre-flight

| Check | Result | Notes |
|-------|--------|-------|
| RPC connectivity | ⬜ | Block number: _N_ |
| V8 bridge accessible | ⬜ | Paused state: _true/false_ |
| Deployer has admin role | ⬜ | Address: _0x..._ |
| Hardhat compiles | ⬜ | Version: _N_ |

## Phase 1 — Deploy & Configure (No Downtime)

| Step | Duration | Result | Tx Hash |
|------|----------|--------|---------|
| Deploy V9 proxy | _Ns_ | ⬜ | `0x...` |
| Verify V9 paused | _Ns_ | ⬜ | — |
| Grant CAP_MANAGER_ROLE | _Ns_ | ⬜ | `0x...` |
| Migrate attestation IDs | _Ns_ | ⬜ | `0x...` |

**V9 Address:** `0x...`

## Phase 2 — Switchover (Target: <10 min downtime)

| Step | Duration | Result | Tx Hash |
|------|----------|--------|---------|
| Pause V8 | _Ns_ | ⬜ | `0x...` |
| Sync final nonce | _Ns_ | ⬜ | `0x...` |
| Revoke V8 BRIDGE_ROLE | _Ns_ | ⬜ | `0x...` |
| Unpause V9 | _Ns_ | ⬜ | `0x...` |

**Total Downtime:** _N seconds_

## Phase 3 — Verification

| Check | Result | Notes |
|-------|--------|-------|
| V9 unpaused | ⬜ | |
| V8 paused | ⬜ | |
| Test attestation submitted | ⬜ | Amount: _1 mUSD_ |
| Supply cap updated | ⬜ | New cap: _N_ |
| Emergency pause/unpause | ⬜ | |
| Prometheus /metrics working | ⬜ | HTTP 200, text/plain |
| Relay health check | ⬜ | |

## Rollback Drill

| Step | Duration | Result |
|------|----------|--------|
| 1. Pause V9 | _Ns_ | ⬜ |
| 2. Revoke V9 CAP_MANAGER_ROLE | _Ns_ | ⬜ |
| 3. Re-grant V8 BRIDGE_ROLE | _Ns_ | ⬜ |
| 4. Unpause V8 | _Ns_ | ⬜ |
| 5. Update relay config | _Ns_ | ⬜ |
| 6. Sync V8 nonce | _Ns_ | ⬜ |

**Total Rollback Time:** _N seconds_

## 24h Soak Checklist

After cutover, monitor the following Prometheus metrics and Grafana dashboards for 24 hours:

- [ ] `minted_tx_reverts_total` — No increase
- [ ] `minted_attestations_processed_total{status="success"}` — Incrementing normally
- [ ] `minted_anomaly_detector_pause_triggered` — Stays at 0
- [ ] `minted_bridge_validation_failures_total` — Stays at 0
- [ ] `minted_relay_consecutive_failures` — Stays below threshold (3)
- [ ] Grafana "Bridge Relay Throughput" dashboard — All panels green
- [ ] No `BridgeValidationFailures` alert firing
- [ ] No `AnomalyPauseTriggered` alert firing
- [ ] Canton audit log — `Bridge_ReceiveFromEthereum` exercises succeeding
- [ ] Bridge-out (Ethereum → Canton) — Working for user requests
- [ ] Supply cap — Matches expected value after attestations
- [ ] Rate limiter — Not hitting caps unexpectedly
- [ ] Memory/CPU — Relay process stable (check `minted_relay_heap_used_bytes`)

## Sign-off

| Role | Name | Date | Signature |
|------|------|------|-----------|
| Bridge Engineer | | | |
| SRE Lead | | | |
| Security | | | |

---

## Decision

- [ ] **PROCEED** to mainnet migration
- [ ] **HOLD** — address issues listed above
- [ ] **ABORT** — fundamental issues found

---

*Template version 1.0 — auto-generated from `scripts/rehearsal-v9-migration.sh`*
