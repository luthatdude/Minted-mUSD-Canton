<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/Treasury.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> Treasury.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">18.63% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>19/102</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">11.11% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>12/108</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">31.25% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>5/16</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">21.1% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>23/109</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
// BLE Protocol - Treasury
// Holds USDC backing for mUSD, supports yield strategy deployment with auto-allocation
&nbsp;
pragma solidity 0.8.26;
&nbsp;
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";
import "@openzeppelin/contracts/access/AccessControl.sol";
import "@openzeppelin/contracts/utils/ReentrancyGuard.sol";
import "./interfaces/IStrategy.sol";
&nbsp;
/// @title Treasury
/// @notice Custodies USDC backing for mUSD. Auto-deploys to yield strategies on deposit.
/// @dev Only DirectMint and authorized strategies can deposit/withdraw.
///      When USDC arrives (from mint or bridge-in), it's auto-deployed to the default strategy.
contract Treasury is AccessControl, ReentrancyGuard {
    using SafeERC20 for IERC20;
&nbsp;
    bytes32 public constant MINTER_ROLE = keccak256("MINTER_ROLE");      // DirectMint contract
    bytes32 public constant STRATEGY_ROLE = keccak256("STRATEGY_ROLE");  // Yield strategies
    bytes32 public constant TREASURY_ADMIN_ROLE = keccak256("TREASURY_ADMIN_ROLE");
    bytes32 public constant KEEPER_ROLE = keccak256("KEEPER_ROLE");      // Keeper/bot for auto-deploy
    bytes32 public constant BRIDGE_ROLE = keccak256("BRIDGE_ROLE");      // Bridge contract
&nbsp;
    IERC20 public immutable usdc;
&nbsp;
    // Track how much USDC is deployed to strategies vs held in reserve
    uint256 public deployedToStrategies;
&nbsp;
    // Per-strategy deployment tracking
    mapping(address =&gt; uint256) public strategyDeployments;
&nbsp;
    // Maximum percentage of reserves that can be deployed (basis points, e.g., 8000 = 80%)
    uint256 public maxDeploymentBps;
&nbsp;
    // ============================================================
    //              AUTO-DEPLOY CONFIGURATION
    // ============================================================
&nbsp;
    /// @notice Default strategy for auto-deployment (must have STRATEGY_ROLE)
    address public defaultStrategy;
&nbsp;
    /// @notice Whether auto-deploy on deposit is enabled
    bool public autoDeployEnabled;
&nbsp;
    /// @notice Minimum idle USDC before auto-deploy triggers (prevents dust deploys)
    uint256 public autoDeployThreshold;
&nbsp;
    /// @notice Reserve buffer in basis points (e.g., 1000 = 10% stays liquid)
    uint256 public reserveBufferBps;
&nbsp;
    event Deposited(address indexed from, uint256 amount);
    event Withdrawn(address indexed to, uint256 amount);
    event DeployedToStrategy(address indexed strategy, uint256 amount);
    event WithdrawnFromStrategy(address indexed strategy, uint256 amount);
    event MaxDeploymentUpdated(uint256 oldBps, uint256 newBps);
    event AutoDeployed(address indexed strategy, uint256 amount);
    event AutoDeployConfigUpdated(address defaultStrategy, bool enabled, uint256 threshold, uint256 reserveBps);
    event BridgeDeposit(address indexed from, uint256 amount, bool autoDeploy);
&nbsp;
    constructor(address _usdc, uint256 _maxDeploymentBps) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_usdc != address(0), "INVALID_USDC");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_maxDeploymentBps &lt;= 9000, "MAX_DEPLOY_TOO_HIGH"); // Cap at 90%
&nbsp;
        usdc = IERC20(_usdc);
        maxDeploymentBps = _maxDeploymentBps;
&nbsp;
        // Default auto-deploy config
        autoDeployEnabled = true;
        autoDeployThreshold = 1000e6;  // Min $1000 USDC to auto-deploy
        reserveBufferBps = 1000;       // Keep 10% liquid
&nbsp;
        _grantRole(DEFAULT_ADMIN_ROLE, msg.sender);
        _grantRole(TREASURY_ADMIN_ROLE, msg.sender);
        _grantRole(KEEPER_ROLE, msg.sender);
    }
&nbsp;
    /// @notice Total USDC backing (in treasury + deployed to strategies)
<span class="fstat-no" title="function not covered" >    function totalBacking() external view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        return usdc.balanceOf(address(this)) + deployedToStrategies;</span>
    }
&nbsp;
    /// @notice USDC available in treasury (not deployed)
    function availableReserves() public view returns (uint256) {
        return usdc.balanceOf(address(this));
    }
&nbsp;
    /// @notice Amount deployable after reserving buffer
<span class="fstat-no" title="function not covered" >    function deployableAmount() public view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        uint256 total = usdc.balanceOf(address(this)) + deployedToStrategies;</span>
<span class="cstat-no" title="statement not covered" >        if (total == 0) <span class="cstat-no" title="statement not covered" >return 0;</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint256 targetReserve = (total * reserveBufferBps) / 10000;</span>
<span class="cstat-no" title="statement not covered" >        uint256 currentReserve = usdc.balanceOf(address(this));</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (currentReserve &lt;= targetReserve) <span class="cstat-no" title="statement not covered" >return 0;</span></span>
<span class="cstat-no" title="statement not covered" >        return currentReserve - targetReserve;</span>
    }
&nbsp;
    // ============================================================
    //                  MINTER OPERATIONS
    // ============================================================
&nbsp;
    /// @notice Deposit USDC into treasury (called by DirectMint on user deposit)
    /// @param from The address to pull USDC from (must have approved Treasury)
    /// @param amount Amount of USDC to deposit
    function deposit(address from, uint256 amount) external <span class="missing-if-branch" title="else path not taken" >E</span>onlyRole(MINTER_ROLE) <span class="missing-if-branch" title="else path not taken" >E</span>nonReentrant {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(amount &gt; 0, "INVALID_AMOUNT");
        usdc.safeTransferFrom(from, address(this), amount);
        emit Deposited(from, amount);
&nbsp;
        // Auto-deploy to default strategy if enabled
        _tryAutoDeploy();
    }
&nbsp;
    /// @notice Deposit USDC from bridge (Canton → Ethereum backing)
    /// @param from The address to pull USDC from
    /// @param amount Amount of USDC bridged in
<span class="fstat-no" title="function not covered" >    function depositFromBridge(address from, uint256 amount) external onlyRole(BRIDGE_ROLE) nonReentrant {</span>
<span class="cstat-no" title="statement not covered" >        require(amount &gt; 0, "INVALID_AMOUNT")</span>;
<span class="cstat-no" title="statement not covered" >        usdc.safeTransferFrom(from, address(this), amount)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        bool deployed = _tryAutoDeploy();</span>
<span class="cstat-no" title="statement not covered" >        emit BridgeDeposit(from, amount, deployed);</span>
    }
&nbsp;
    /// @notice Withdraw USDC from treasury (called by DirectMint on user redemption)
    /// @param to The address to send USDC to
    /// @param amount Amount of USDC to withdraw
    function withdraw(address to, uint256 amount) external <span class="missing-if-branch" title="else path not taken" >E</span>onlyRole(MINTER_ROLE) <span class="missing-if-branch" title="else path not taken" >E</span>nonReentrant {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(amount &gt; 0, "INVALID_AMOUNT");
&nbsp;
        // If not enough in reserve, pull from strategy
        uint256 reserve = availableReserves();
        <span class="missing-if-branch" title="if path not taken" >I</span>if (reserve &lt; amount &amp;&amp; defaultStrategy != address(0)) {
<span class="cstat-no" title="statement not covered" >            uint256 needed = amount - reserve;</span>
<span class="cstat-no" title="statement not covered" >            _withdrawFromDefaultStrategy(needed)</span>;
        }
&nbsp;
        <span class="missing-if-branch" title="else path not taken" >E</span>require(availableReserves() &gt;= amount, "INSUFFICIENT_RESERVES");
        usdc.safeTransfer(to, amount);
        emit Withdrawn(to, amount);
    }
&nbsp;
    // ============================================================
    //                  YIELD STRATEGY OPERATIONS
    // ============================================================
&nbsp;
    /// @notice Deploy USDC to a yield strategy
    /// @param strategy The strategy contract address (must have STRATEGY_ROLE)
    /// @param amount Amount to deploy
    // FIX H-03: Require strategy to have STRATEGY_ROLE before sending funds
    // FIX M-12: Guard against division by zero when totalAssets is 0
<span class="fstat-no" title="function not covered" >    function deployToStrategy(</span>
        address strategy,
        uint256 amount
    ) external onlyRole(TREASURY_ADMIN_ROLE) nonReentrant {
<span class="cstat-no" title="statement not covered" >        require(amount &gt; 0, "INVALID_AMOUNT")</span>;
<span class="cstat-no" title="statement not covered" >        require(amount &lt;= availableReserves(), "INSUFFICIENT_RESERVES")</span>;
        // FIX H-03: Only deploy to authorized strategy contracts
<span class="cstat-no" title="statement not covered" >        require(hasRole(STRATEGY_ROLE, strategy), "STRATEGY_NOT_AUTHORIZED")</span>;
&nbsp;
        // FIX M-12: Guard against division by zero
<span class="cstat-no" title="statement not covered" >        uint256 totalAssets = availableReserves() + deployedToStrategies;</span>
<span class="cstat-no" title="statement not covered" >        require(totalAssets &gt; 0, "NO_ASSETS_AVAILABLE")</span>;
<span class="cstat-no" title="statement not covered" >        uint256 newDeployed = deployedToStrategies + amount;</span>
<span class="cstat-no" title="statement not covered" >        require(</span>
            (newDeployed * 10000) / totalAssets &lt;= maxDeploymentBps,
            "EXCEEDS_MAX_DEPLOYMENT"
        );
&nbsp;
        deployedToStrategies += amount;
        strategyDeployments[strategy] += amount;
&nbsp;
<span class="cstat-no" title="statement not covered" >        usdc.safeTransfer(strategy, amount)</span>;
<span class="cstat-no" title="statement not covered" >        emit DeployedToStrategy(strategy, amount);</span>
    }
&nbsp;
    /// @notice Record USDC returned from a strategy
    /// @param amount Amount returned
<span class="fstat-no" title="function not covered" >    function recordStrategyReturn(uint256 amount) external onlyRole(STRATEGY_ROLE) nonReentrant {</span>
<span class="cstat-no" title="statement not covered" >        require(amount &gt; 0, "INVALID_AMOUNT")</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint256 deployed = strategyDeployments[msg.sender];</span>
<span class="cstat-no" title="statement not covered" >        uint256 reduction = amount &gt; deployed ? deployed : amount;</span>
&nbsp;
        strategyDeployments[msg.sender] -= reduction;
        deployedToStrategies -= reduction;
&nbsp;
        // Strategy must transfer USDC back before calling this
        // (pull pattern: strategy approves, treasury pulls)
<span class="cstat-no" title="statement not covered" >        usdc.safeTransferFrom(msg.sender, address(this), amount)</span>;
<span class="cstat-no" title="statement not covered" >        emit WithdrawnFromStrategy(msg.sender, amount);</span>
    }
&nbsp;
    /// @notice Update maximum deployment percentage
<span class="fstat-no" title="function not covered" >    function setMaxDeploymentBps(uint256 _bps) external onlyRole(TREASURY_ADMIN_ROLE) {</span>
<span class="cstat-no" title="statement not covered" >        require(_bps &lt;= 9000, "MAX_DEPLOY_TOO_HIGH")</span>;
<span class="cstat-no" title="statement not covered" >        uint256 old = maxDeploymentBps;</span>
        maxDeploymentBps = _bps;
<span class="cstat-no" title="statement not covered" >        emit MaxDeploymentUpdated(old, _bps);</span>
    }
&nbsp;
    // ============================================================
    //              AUTO-DEPLOY MECHANISM
    // ============================================================
&nbsp;
    /// @notice Configure auto-deploy settings
    /// @param _defaultStrategy Strategy address for auto-deployment (must have STRATEGY_ROLE)
    /// @param _enabled Enable/disable auto-deploy
    /// @param _threshold Minimum idle USDC before auto-deploy triggers
    /// @param _reserveBps Reserve buffer in basis points
<span class="fstat-no" title="function not covered" >    function setAutoDeployConfig(</span>
        address _defaultStrategy,
        bool _enabled,
        uint256 _threshold,
        uint256 _reserveBps
    ) external onlyRole(TREASURY_ADMIN_ROLE) {
<span class="cstat-no" title="statement not covered" >        require(_reserveBps &lt;= 5000, "RESERVE_TOO_HIGH")</span>; // Max 50% reserve
&nbsp;
        // If setting a strategy, it must be authorized
<span class="cstat-no" title="statement not covered" >        if (_defaultStrategy != address(0)) {</span>
<span class="cstat-no" title="statement not covered" >            require(hasRole(STRATEGY_ROLE, _defaultStrategy), "STRATEGY_NOT_AUTHORIZED")</span>;
        }
&nbsp;
        defaultStrategy = _defaultStrategy;
        autoDeployEnabled = _enabled;
        autoDeployThreshold = _threshold;
        reserveBufferBps = _reserveBps;
&nbsp;
<span class="cstat-no" title="statement not covered" >        emit AutoDeployConfigUpdated(_defaultStrategy, _enabled, _threshold, _reserveBps);</span>
    }
&nbsp;
    /// @notice Try auto-deploy to default strategy
    /// @return deployed Whether deployment occurred
    function _tryAutoDeploy() internal returns (bool deployed) {
        <span class="missing-if-branch" title="if path not taken" >I</span>if (!autoDeployEnabled) <span class="cstat-no" title="statement not covered" >return false;</span>
        <span class="missing-if-branch" title="else path not taken" >E</span>if (defaultStrategy == address(0)) return false;
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint256 deployable = deployableAmount();</span>
<span class="cstat-no" title="statement not covered" >        if (deployable &lt; autoDeployThreshold) <span class="cstat-no" title="statement not covered" >return false;</span></span>
&nbsp;
        // Deploy to default strategy
<span class="cstat-no" title="statement not covered" >        return _deployToDefaultStrategy(deployable);</span>
    }
&nbsp;
    /// @notice Deploy to default strategy
<span class="fstat-no" title="function not covered" >    function _deployToDefaultStrategy(uint256 amount) internal returns (bool) {</span>
<span class="cstat-no" title="statement not covered" >        if (amount == 0 || defaultStrategy == address(0)) <span class="cstat-no" title="statement not covered" >return false;</span></span>
&nbsp;
        // Verify strategy is still authorized
<span class="cstat-no" title="statement not covered" >        if (!hasRole(STRATEGY_ROLE, defaultStrategy)) <span class="cstat-no" title="statement not covered" >return false;</span></span>
&nbsp;
        // Check max deployment limit
<span class="cstat-no" title="statement not covered" >        uint256 totalAssets = availableReserves() + deployedToStrategies;</span>
<span class="cstat-no" title="statement not covered" >        if (totalAssets == 0) <span class="cstat-no" title="statement not covered" >return false;</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint256 newDeployed = deployedToStrategies + amount;</span>
<span class="cstat-no" title="statement not covered" >        if ((newDeployed * 10000) / totalAssets &gt; maxDeploymentBps) {</span>
            // Reduce amount to stay within limit
<span class="cstat-no" title="statement not covered" >            uint256 maxAllowed = (totalAssets * maxDeploymentBps) / 10000;</span>
<span class="cstat-no" title="statement not covered" >            if (maxAllowed &lt;= deployedToStrategies) <span class="cstat-no" title="statement not covered" >return false;</span></span>
            amount = maxAllowed - deployedToStrategies;
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (amount == 0) <span class="cstat-no" title="statement not covered" >return false;</span></span>
&nbsp;
        // Approve and deposit to strategy
<span class="cstat-no" title="statement not covered" >        usdc.forceApprove(defaultStrategy, amount)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        try IStrategy(defaultStrategy).deposit(amount) returns (uint256 deposited) {</span>
            deployedToStrategies += deposited;
            strategyDeployments[defaultStrategy] += deposited;
<span class="cstat-no" title="statement not covered" >            emit AutoDeployed(defaultStrategy, deposited);</span>
<span class="cstat-no" title="statement not covered" >            return true;</span>
        } catch {
<span class="cstat-no" title="statement not covered" >            usdc.forceApprove(defaultStrategy, 0)</span>;
<span class="cstat-no" title="statement not covered" >            return false;</span>
        }
    }
&nbsp;
    /// @notice Withdraw from default strategy
<span class="fstat-no" title="function not covered" >    function _withdrawFromDefaultStrategy(uint256 amount) internal returns (uint256 withdrawn) {</span>
<span class="cstat-no" title="statement not covered" >        if (defaultStrategy == address(0)) <span class="cstat-no" title="statement not covered" >return 0;</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint256 strategyBalance = strategyDeployments[defaultStrategy];</span>
<span class="cstat-no" title="statement not covered" >        if (strategyBalance == 0) <span class="cstat-no" title="statement not covered" >return 0;</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint256 toWithdraw = amount &gt; strategyBalance ? strategyBalance : amount;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        try IStrategy(defaultStrategy).withdraw(toWithdraw) returns (uint256 actual) {</span>
            withdrawn = actual;
<span class="cstat-no" title="statement not covered" >            uint256 reduction = actual &gt; strategyBalance ? strategyBalance : actual;</span>
            strategyDeployments[defaultStrategy] -= reduction;
            deployedToStrategies -= reduction;
<span class="cstat-no" title="statement not covered" >            emit WithdrawnFromStrategy(defaultStrategy, actual);</span>
        } catch {
            withdrawn = 0;
        }
    }
&nbsp;
    /// @notice Keeper can trigger auto-deploy when idle funds accumulate
    /// @return deployed Amount deployed
<span class="fstat-no" title="function not covered" >    function keeperTriggerAutoDeploy() external onlyRole(KEEPER_ROLE) nonReentrant returns (uint256 deployed) {</span>
<span class="cstat-no" title="statement not covered" >        require(autoDeployEnabled, "AUTO_DEPLOY_DISABLED")</span>;
<span class="cstat-no" title="statement not covered" >        require(defaultStrategy != address(0), "NO_DEFAULT_STRATEGY")</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint256 deployable = deployableAmount();</span>
<span class="cstat-no" title="statement not covered" >        require(deployable &gt;= autoDeployThreshold, "BELOW_THRESHOLD")</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (_deployToDefaultStrategy(deployable)) {</span>
<span class="cstat-no" title="statement not covered" >            return deployable;</span>
        }
<span class="cstat-no" title="statement not covered" >        return 0;</span>
    }
&nbsp;
    /// @notice Public view: check if auto-deploy would trigger
<span class="fstat-no" title="function not covered" >    function shouldAutoDeploy() external view returns (bool, uint256) {</span>
<span class="cstat-no" title="statement not covered" >        if (!autoDeployEnabled) <span class="cstat-no" title="statement not covered" >return (false, 0);</span></span>
<span class="cstat-no" title="statement not covered" >        if (defaultStrategy == address(0)) <span class="cstat-no" title="statement not covered" >return (false, 0);</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint256 deployable = deployableAmount();</span>
<span class="cstat-no" title="statement not covered" >        return (deployable &gt;= autoDeployThreshold, deployable);</span>
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sat Jan 31 2026 16:59:22 GMT-0500 (Eastern Standard Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
